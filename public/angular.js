"use strict";var app=angular.module("app",["btford.socket-io","ui.router","ngRoute","ngStorage","ngFlash"]).factory("mySocket",function(e){return e()});app.factory("AuthService",["$http","$localStorage","$q","$window",function(e,t,n){return console.log("carreguei"),{getToken:function(){return t.token},setToken:function(e){t.token=e},signin:function(t){return e.post("/",t)},signup:function(t){return e.post("api/signup",t)},logout:function(){delete t.token,n.when()}}}]),app.factory("authInterceptor",["$q","$window","$localStorage",function(e,t,n){return{request:function(e){return e.headers=e.headers||{},n.token&&(e.headers["x-access-token"]=n.token),e},responseError:function(t){return 401!==t.status&&403!==t.status||$location.path("/"),e.reject(t)}}}]),app.config(function(e){e.interceptors.push("authInterceptor")}),app.run(function(e,t,n){e.$on("$routeChangeStart",function(o,r,a){r.authorize&&(n.getToken()||e.$evalAsync(function(){t.path("/")}))})}),app.config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("login",{url:"/",templateUrl:"paginas/login/index.html",authorize:!1,controller:"UserCtrl"}).state("painel",{url:"/painel",templateUrl:"paginas/painel/index.html",authorize:!0}),t.otherwise("/")}]),app.config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("painel.usuario",{url:"/usuario",templateUrl:"paginas/login/index.html",authorize:!1,controller:"UserCtrl"}),t.otherwise("/")}]),app.controller("PainelCtrl",["$scope","AuthService","$location","$http",function(e,t,n,o){o.get("/api/user").then(function(e){console.log(e)}),e.menuItems=[{name:"Usuários",url:"/painel/user"},{name:"Estabelecimentos",url:"/painel/estabelcimento"},{name:"Clientes",url:"/painel/clientes"},{name:"Tabelas de Preço",url:"/painel/preco"},{name:"Lava Jato",url:"/painel/lavajato"},{name:"Convênios",url:"/painel/convenio"},{name:"Mensalidades",url:"/painel/lavajato"}],e.sair=function(){t.logout(),n.path("/")}}]),app.controller("UserCtrl",["$scope","AuthService","Flash","$location",function(e,t,n,o){e.user={},e.error={},n.timeout=5e3,e.logar=function(r){t.signin(r).then(function(r){n.clear(),r.data.success?(t.setToken(r.data.token),o.path("/painel")):(e.error=r.data,n.create("danger",e.error.message),delete e.error)},function(e){$log(e)})}}]);